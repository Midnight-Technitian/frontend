
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <!--  Scripts to preload  -->
    <link href="/css/dashboard.css" rel="stylesheet">
    <link href="/css/new_ticket.css" rel="stylesheet">

    <script type="text/javascript" src="/js/ServiceTicket.js"></script>

    <title>Dashboard - Midnight Technician</title>
</head>
<body>
<div th:replace="~{fragments/header::header}"></div>

<!-- Welcome Header -->
<div class="dashboard-header">
    <div class="container">
        <div class="welcome-section">
            <h1 class="welcome-title">
                Welcome back, <span th:text="${customer.firstName()}" class="customer-name">User</span>!
            </h1>
            <p class="welcome-subtitle">Manage your devices and service tickets from your dashboard</p>
        </div>
    </div>
</div>

<!-- Main Dashboard Content -->
<div class="container dashboard-container">

    <!-- Quick Actions -->
    <section class="quick-actions-section">
        <div class="actions-grid">
            <button class="action-card new-ticket" onclick="openNewTicketModal()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                </div>
                <h3>New Service Ticket</h3>
                <p>Report an issue or request service</p>
            </button>

            <button class="action-card new-device" onclick="openNewDeviceModal()">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                        <line x1="8" y1="21" x2="16" y2="21"></line>
                        <line x1="12" y1="17" x2="12" y2="21"></line>
                        <line x1="12" y1="7" x2="12" y2="13"></line>
                        <line x1="9" y1="10" x2="15" y2="10"></line>
                    </svg>
                </div>
                <h3>Register Device</h3>
                <p>Add a new device to your account</p>
            </button>
        </div>
    </section>

    <!-- Service Tickets Section -->
    <section class="tickets-section">
        <div th:replace="~{fragments/view/customer_dashboard/customer_tickets::customer_tickets}"></div>
    </section>

    <!-- Registered Devices Section -->
    <section class="devices-section">
        <div th:replace="~{fragments/view/customer_dashboard/customer_devices::customer_devices}"></div>
    </section>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <p class="tagline"><em>Midnight Technician â€“ Technology Made Easy.</em></p>
    </footer>
</div>

<div id="newTicketModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeNewTicketModal()">&times;</span>
        <h2>New Service Ticket</h2>
        <form id="newServiceRequest" onsubmit="submitNewTicket(event)">
            <!--  Have the customerId as an element in the form, so that it can be sent with the request  -->
            <input type="hidden" id="customerId" name="customerId" th:value="${customer.email()}">

            <label for="deviceId">Select Existing Device</label>
            <select id="deviceId" name="deviceId">
                <!-- Default "None" option -->
                <option value="">New Device</option>
                <!-- Populate dynamically from backend -->
                <option th:each="device : ${devices}"
                        th:value="${device.deviceId()}"
                        th:text="${device.deviceName()}">
                </option>
            </select>

            <label for="deviceName">Device Name/Type</label>
            <input type="text" id="deviceName" name="deviceName" placeholder="e.g. Gaming Desktop" required>

            <label for="serviceId">Service Type</label>
            <!-- TODO: Fetch a list of services from the backend -->
            <select id="serviceId" name="serviceId" required>
                <option th:each="service : ${services}"
                        th:value="${service.serviceId}"
                        th:text="${service.serviceName}">
                </option>
            </select>

            <label for="description">Description</label>
            <textarea id="description" name="description" rows="4" placeholder="Describe the issue or request..." required></textarea>

            <button type="submit" class="submit-btn">Submit Ticket</button>
        </form>
    </div>
</div>
<script>
    function openNewDeviceModal() {
        alert('Open New Device Modal - Connect to your form/modal here');
    }
</script>
</body>
</html>